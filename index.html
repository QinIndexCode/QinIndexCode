<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="QinIndexCode - ‰∏™‰∫∫ÊäÄÊúØÂçöÂÆ¢Ôºå‰∏ìÊ≥®‰∫éÂÖ®Ê†àÂºÄÂèë„ÄÅWebÂºÄÂèë„ÄÅÁßªÂä®Â∫îÁî®ÂºÄÂèëÁ≠âÊäÄÊúØÈ¢ÜÂüü">
    <meta name="theme-color" content="#0B0C15">
    <title>‰∏™‰∫∫ÊäÄÊúØÂçöÂÆ¢ QinIndexCode</title>
    <link href="./css/css2.css" rel="stylesheet">
    <link href="./css/main.css" rel="stylesheet">
    <script src="./js/smooth-scroll.js" defer></script>
    <style>
        /* ÊµÆÂä®ÊñáÂ≠ó‰ºòÂåñ */
        .floating-text {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            background: rgba(99, 102, 241, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            white-space: normal; /* Allow wrap */
            min-width: 120px; /* Min width */
            max-width: 200px; /* Max width constraint */
            text-align: center;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            font-weight: 600;
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        /* Triangle arrow */
        .floating-text::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px 6px 0;
            border-style: solid;
            border-color: rgba(99, 102, 241, 0.9) transparent transparent transparent;
        }

        .floating-text.show { 
            opacity: 1; 
            transform: translateX(-50%) scale(1) translateY(-10px);
        }

        /* ‰∏ªÈ¢òÈÄâÊã©Âô®ÊåâÈíÆ (ÁÆÄÂåñÁâà) */
        .theme-selector {
            position: fixed;
            top: 1.5rem;
            right: 2rem;
            z-index: 100;
        }

        .theme-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
            position: relative;
            z-index: 101;
        }

        .theme-btn:hover {
            background: var(--glass-bg-hover);
            transform: scale(1.05);
        }

        .stat-num {
            font-size: 2rem;
            font-weight: 700;
            color: var(--stat-color, #fff);
            display: block;
        }

        /* Hero Section */
        .hero {
            min-height: 60vh;
            display: flex;
            align-items: center;
            position: relative;
        }

        .hero-content {
            z-index: 2;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            background: var(--hero-text-gradient, linear-gradient(to right, #fff, #94a3b8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--spacing-md);
        }

        .hero p.tagline {
            font-size: 1.25rem;
            color: var(--accent-blue);
            font-weight: 500;
            margin-bottom: var(--spacing-xl);
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 50px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .section-title {
            color: var(--text-primary); /* Ensure titles adapt */
        }

        /* Skip Link - ÂèØËÆøÈóÆÊÄßË∑≥ËΩ¨ÈìæÊé•Ê†∑Âºè */
        .skip-link {
            position: absolute;
            top: -100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gradient-primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            font-weight: 600;
            z-index: 1000;
            transition: top 0.3s ease;
            text-decoration: none;
            box-shadow: var(--shadow-md);
        }

        .skip-link:focus {
            top: 0;
            outline: none;
        }

        /* Avatar Wrapper with Glow */
        .avatar-wrapper {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto;
            border-radius: 50%;
            padding: 5px;
            background: var(--gradient-primary);
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.3);
            animation: float 6s ease-in-out infinite;
        }

        .avatar-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            background: var(--bg-primary);
            border: 4px solid var(--bg-primary);
        }

        .profile-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--profile-name-color, var(--text-primary));
            letter-spacing: 0.025em;
        }
    </style>
</head>
<body>
    <!-- Skip to content - ÂèØËÆøÈóÆÊÄßË∑≥ËΩ¨ÈìæÊé• -->
    <a href="#viewport" class="skip-link">Ë∑≥ËΩ¨Âà∞‰∏ªÂÜÖÂÆπ</a>

    <!-- ÁßªÂä®Á´ØËèúÂçïÊåâÈíÆ (Âä®ÁîªÁâà) -->
    <button class="hamburger-btn" id="hamburger-btn" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- ‰∏ªÈ¢òÈÄâÊã©Âô® -->
    <div class="theme-selector" id="theme-selector">
        <button class="theme-btn" id="theme-btn" aria-label="Toggle Theme">
            <!-- Moon Icon (Dark Mode) -->
            <svg id="icon-dark" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            <!-- Sun Icon (Light Mode) - Hidden by default -->
            <svg id="icon-light" style="display:none;" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        </button>
    </div>
    
    <!-- ‰æßËæπÊ†èÈÅÆÁΩ©Â±Ç -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="main-container">
        <!-- ‰æßËæπÊ†è -->
        <aside class="sidebar glass" id="sidebar">
            <div class="profile-section">
                <div class="profile-avatar" id="avatar">
                    <img src="assets/images/avatar.jpg" alt="Avatar" width="100" height="100" loading="lazy">
                    <div class="floating-text" id="floating-text"></div>
                </div>
                <div class="profile-name">QinIndexCode</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <div class="nav-link active" data-target="home" data-src="home.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/home.svg" class="nav-icon" alt="Home"></div>
                        <span>È¶ñÈ°µ</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="tech" data-src="tech.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/technical.svg" class="nav-icon" alt="Tech"></div>
                        <span>ÊäÄÊúØ</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="projects" data-src="projects.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/project.svg" class="nav-icon" alt="Projects"></div>
                        <span>È°πÁõÆ</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="blogs" data-src="blogs.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/blog.svg" class="nav-icon" alt="Blog"></div>
                        <span>ÈöèËÆ∞</span>
                    </div>
                </li>
                 <li class="nav-item">
                    <div class="nav-link" data-target="tools" data-src="tools.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/tool.svg" class="nav-icon" alt="Tool"></div>
                        <span>Â∑•ÂÖ∑</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="donate" data-src="donate.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/donate.svg" class="nav-icon" alt="Donate"></div>
                        <span>ÊçêËµ†</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="about" data-src="about.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/aboutMe.svg" class="nav-icon" alt="About"></div>
                        <span>ÂÖ≥‰∫é</span>
                    </div>
                </li>
            
            </ul>
        </aside>

        <!-- ËßÜÂè£Âå∫Âüü -->
        <main class="viewport" id="viewport">
            <!-- È™®Êû∂Â±è -->
            <div class="skeleton-screen" id="skeleton-screen">
                <div class="skeleton skeleton-header"></div>
                <div class="skeleton-grid">
                    <div class="skeleton skeleton-card"></div>
                    <div class="skeleton skeleton-card"></div>
                    <div class="skeleton skeleton-card"></div>
                </div>
            </div>
            
            <!-- ÊªëÂä®ÂÆπÂô® -->
            <div id="page-slider">
                <!-- Iframes will be injected here -->
            </div>
        </main>
    </div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW failed', err));
            });
        }

        // Â§ÑÁêÜ OAuth ÂõûË∞ÉÂíåÁã¨Á´ãÈ°µÈù¢ËÆøÈóÆ
        let initialPage = 'home'; // ÈªòËÆ§È°µÈù¢
        let shouldSwitchPage = false;

        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Ê£ÄÊü• OAuth ÂõûË∞É
            const redirect = urlParams.get('redirect');
            // Ê£ÄÊü•Áã¨Á´ãÈ°µÈù¢ËÆøÈóÆ
            const fromPage = urlParams.get('from');
            
            let targetPage = null;
            
            if (redirect) {
                // OAuth ÂõûË∞ÉÂú∫ÊôØ
                try {
                    const redirectUrl = new URL(redirect);
                    const pathname = redirectUrl.pathname;
                    const pageName = pathname.split('/').pop().replace('.html', '') || 'home';
                    targetPage = pageName;
                    console.log('‚úÖ OAuth ÂõûË∞ÉÔºåÁõÆÊ†áÈ°µÈù¢:', pageName);
                } catch (e) {
                    console.error('‚ùå Ëß£Êûê redirect URL Â§±Ë¥•:', e);
                }
            } else if (fromPage) {
                // Áã¨Á´ãÈ°µÈù¢ËÆøÈóÆÂú∫ÊôØ
                targetPage = fromPage;
                console.log('‚úÖ Áã¨Á´ãÈ°µÈù¢ËÆøÈóÆÔºåÊù•Ê∫êÈ°µÈù¢:', fromPage);
            }
            
            // Â¶ÇÊûúÊâæÂà∞‰∫ÜÁõÆÊ†áÈ°µÈù¢
            if (targetPage) {
                initialPage = targetPage;
                shouldSwitchPage = true;
                console.log('‚úÖ ËÆæÁΩÆÂàùÂßãÈ°µÈù¢‰∏∫:', initialPage);
            } else {
                console.log('‚ÑπÔ∏è ‰ΩøÁî®ÈªòËÆ§È¶ñÈ°µ');
            }
        });

        class PageSlider {
            constructor() {
                this.slider = document.getElementById('page-slider');
                this.navLinks = document.querySelectorAll('.nav-link');
                this.pages = Array.from(this.navLinks).map(link => ({
                    id: link.dataset.target,
                    src: link.dataset.src
                }));
                
                // Â¶ÇÊûúÊòØ OAuth ÂõûË∞ÉÔºåÁõ¥Êé•ËÆæÁΩÆ‰∏∫ÁõÆÊ†áÈ°µÈù¢
                this.currentIndex = shouldSwitchPage 
                    ? this.pages.findIndex(p => p.id === initialPage) 
                    : 0;
                
                // Â¶ÇÊûúÊâæ‰∏çÂà∞ÁõÆÊ†áÈ°µÈù¢ÔºåÂõûÂà∞È¶ñÈ°µ
                if (this.currentIndex === -1) {
                    this.currentIndex = 0;
                }
                
                this.isAnimating = false;
                
                // Touch state
                this.startX = 0;
                this.currentX = 0;
                this.isDragging = false;
                
                this.init();
            }

            init() {
                // Â¶ÇÊûúÊòØÁõÆÊ†áÈ°µÈù¢ËÆøÈóÆÔºåÂÖàËÆæÁΩÆ slider ÁöÑÂàùÂßã‰ΩçÁΩÆ
                if (shouldSwitchPage) {
                    const targetIndex = this.pages.findIndex(p => p.id === initialPage);
                    if (targetIndex !== -1) {
                        // Âú®ÂàõÂª∫ iframe ‰πãÂâçÂ∞±ËÆæÁΩÆ slider ‰ΩçÁΩÆ
                        this.slider.style.transform = `translate3d(${-targetIndex * 100}%, 0, 0)`;
                        console.log(`üìç È¢ÑËÆæ slider ‰ΩçÁΩÆÔºö${-targetIndex * 100}%`);
                    }
                }

                // Initialize iframes
                this.pages.forEach((page, index) => {
                    const iframe = document.createElement('iframe');
                    iframe.className = 'page-frame';
                    iframe.dataset.id = page.id;
                    iframe.title = page.id; // Ê∑ªÂä†ÂèØËÆøÈóÆÊÄßÊ†áÈ¢ò

                    // Attach load event for theme sync
                    iframe.addEventListener('load', () => {
                        if (window.getCurrentTheme) {
                            applyThemeToFrame(iframe, window.getCurrentTheme());
                        }
                        if (index === 0) document.getElementById('skeleton-screen').classList.add('hidden');
                    });

                    // ÈîôËØØÂ§ÑÁêÜÔºöÂä†ËΩΩÂ§±Ë¥•Êó∂ÊòæÁ§∫ÂèãÂ•ΩÊèêÁ§∫
                    iframe.addEventListener('error', () => {
                        this.handleIframeError(iframe, page);
                    });

                    // Ë∂ÖÊó∂Â§ÑÁêÜÔºö5 ÁßíÂÜÖÊú™Âä†ËΩΩÂÆåÊàêËßÜ‰∏∫Â§±Ë¥•
                    const loadTimeout = setTimeout(() => {
                        if (!iframe.contentDocument || iframe.contentDocument.body.innerHTML === '') {
                            this.handleIframeError(iframe, page);
                        }
                    }, 5000);

                    iframe.addEventListener('load', () => {
                        clearTimeout(loadTimeout);
                    }, { once: true });

                    // Â¶ÇÊûúÊòØ OAuth ÂõûË∞ÉÊàñÁã¨Á´ãÈ°µÈù¢ËÆøÈóÆÔºåÂè™Âä†ËΩΩÁõÆÊ†áÈ°µÈù¢
                    const isTargetPage = shouldSwitchPage && page.id === initialPage;
                    
                    // Â¶ÇÊûúÊúâÁõÆÊ†áÈ°µÈù¢ÔºåÂè™Âä†ËΩΩÁõÆÊ†áÈ°µÈù¢ÔºõÂê¶ÂàôÂä†ËΩΩÈ¶ñÈ°µ
                    if (shouldSwitchPage) {
                        // Âè™Âä†ËΩΩÁõÆÊ†áÈ°µÈù¢
                        if (isTargetPage) {
                            console.log(`üéØ Âä†ËΩΩÁõÆÊ†áÈ°µÈù¢ iframe: ${page.id}`);
                            iframe.src = page.src;
                        }
                    } else {
                        // ÈªòËÆ§Âä†ËΩΩÈ¶ñÈ°µ
                        if (index === 0) {
                            iframe.src = page.src;
                        }
                    }
                    this.slider.appendChild(iframe);
                });

                // Â¶ÇÊûúÊòØÁõÆÊ†áÈ°µÈù¢ËÆøÈóÆÔºåÁ°Æ‰øù slider ‰ΩçÁΩÆÊ≠£Á°ÆÔºàÂÜçÊ¨°Á°ÆËÆ§Ôºâ
                if (shouldSwitchPage) {
                    const targetIndex = this.pages.findIndex(p => p.id === initialPage);
                    if (targetIndex !== -1) {
                        // ËÆæÁΩÆ currentIndex
                        this.currentIndex = targetIndex;
                        // ÂÜçÊ¨°Á°Æ‰øù slider ‰ΩçÁΩÆÊ≠£Á°Æ
                        this.slider.style.transition = 'none';
                        this.slider.style.transform = `translate3d(${-targetIndex * 100}%, 0, 0)`;
                        console.log(`üìç Á°ÆËÆ§ slider ‰ΩçÁΩÆÔºöindex=${targetIndex}, page=${initialPage}`);
                    }
                }

                // Lazy load others
                setTimeout(() => this.loadOtherPages(), 2000);

                // Bind Nav Events
                this.navLinks.forEach((link, index) => {
                    link.addEventListener('click', () => this.goToPage(index));
                });

                // Â¶ÇÊûúÊòØ OAuth ÂõûË∞ÉÊàñÁã¨Á´ãÈ°µÈù¢ËÆøÈóÆÔºåËÆæÁΩÆÊ≠£Á°ÆÁöÑÂØºËà™ÊøÄÊ¥ªÁä∂ÊÄÅ
                if (shouldSwitchPage) {
                    const targetIndex = this.pages.findIndex(p => p.id === initialPage);
                    if (targetIndex !== -1) {
                        // ÁßªÈô§ÊâÄÊúâÊøÄÊ¥ªÁä∂ÊÄÅ
                        this.navLinks.forEach(link => link.classList.remove('active'));
                        // ËÆæÁΩÆÁõÆÊ†áÂØºËà™‰∏∫ÊøÄÊ¥ªÁä∂ÊÄÅ
                        this.navLinks[targetIndex].classList.add('active');
                        console.log(`‚úÖ Â∑≤ËÆæÁΩÆÂØºËà™ÊøÄÊ¥ªÁä∂ÊÄÅÔºö${initialPage}`);
                    }
                }

                // Bind Touch Events
                const viewport = document.getElementById('viewport');
                viewport.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: true });
                viewport.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
                viewport.addEventListener('touchend', this.handleTouchEnd.bind(this));
            }

            handleIframeError(iframe, page) {
                console.error(`Failed to load page: ${page.src}`);
                iframe.srcdoc = `
                    <!DOCTYPE html>
                    <html lang="zh-CN">
                    <head>
                        <meta charset="UTF-8">
                        <style>
                            body {
                                margin: 0;
                                min-height: 100vh;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                background: #0B0C15;
                                color: #94A3B8;
                                font-family: system-ui, -apple-system, sans-serif;
                                text-align: center;
                                padding: 2rem;
                            }
                            .error-icon {
                                width: 64px;
                                height: 64px;
                                margin-bottom: 1.5rem;
                                opacity: 0.5;
                            }
                            h2 {
                                color: #F8FAFC;
                                margin: 0 0 0.5rem 0;
                                font-size: 1.5rem;
                            }
                            p {
                                margin: 0 0 1.5rem 0;
                                max-width: 400px;
                                line-height: 1.6;
                            }
                            .retry-btn {
                                padding: 0.75rem 1.5rem;
                                background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 1rem;
                                transition: transform 0.2s, box-shadow 0.2s;
                            }
                            .retry-btn:hover {
                                transform: translateY(-2px);
                                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
                            }
                        </style>
                    </head>
                    <body>
                        <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                        <h2>È°µÈù¢Âä†ËΩΩÂ§±Ë¥•</h2>
                        <p>Êó†Ê≥ïÂä†ËΩΩ <strong>${page.id}</strong> È°µÈù¢„ÄÇËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÊàñÁÇπÂáªÈáçËØï„ÄÇ</p>
                        <button class="retry-btn" onclick="parent.location.reload()">ÈáçÊñ∞Âä†ËΩΩ</button>
                    </body>
                    </html>
                `;
            }

            loadOtherPages() {
                const frames = this.slider.querySelectorAll('iframe');
                frames.forEach((frame, index) => {
                    // Â¶ÇÊûúÊòØÁõÆÊ†áÈ°µÈù¢ËÆøÈóÆÔºåË∑≥ËøáÈ¶ñÈ°µÔºàindex 0Ôºâ
                    // Â¶ÇÊûúÊòØÈªòËÆ§ËÆøÈóÆÔºåË∑≥ËøáÈ¶ñÈ°µÔºàindex 0Ôºâ
                    // ÂÖ∂‰ªñÈ°µÈù¢Âª∂ËøüÂä†ËΩΩ
                    if (shouldSwitchPage) {
                        // ÁõÆÊ†áÈ°µÈù¢ËÆøÈóÆÔºöÂä†ËΩΩÊâÄÊúâÊú™Âä†ËΩΩÁöÑÈ°µÈù¢ÔºàÈô§‰∫ÜÈ¶ñÈ°µÔºâ
                        if (index !== this.currentIndex && !frame.src) {
                            frame.src = this.pages[index].src;
                        }
                    } else {
                        // ÈªòËÆ§ËÆøÈóÆÔºöÂä†ËΩΩÊâÄÊúâÊú™Âä†ËΩΩÁöÑÈ°µÈù¢ÔºàÈô§‰∫ÜÈ¶ñÈ°µÔºâ
                        if (index !== 0 && !frame.src) {
                            frame.src = this.pages[index].src;
                        }
                    }
                });
            }

            goToPage(index) {
                if (index === this.currentIndex) return;
                
                // Update Nav UI
                this.navLinks.forEach(l => l.classList.remove('active'));
                this.navLinks[index].classList.add('active');

                // Animate Slider
                this.currentIndex = index;
                this.updateSliderPosition(true);

                // Mobile Sidebar Logic (Auto close on selection)
                if (window.innerWidth <= 768) {
                    toggleMenu(false); // Close menu
                }
            }

            updateSliderPosition(animate = false) {
                const offset = -(this.currentIndex * 100);
                
                if (animate) {
                    // Optimized cubic-bezier for silkier transition
                    this.slider.style.transition = 'transform 0.6s cubic-bezier(0.22, 1, 0.36, 1)';
                } else {
                    this.slider.style.transition = 'none';
                }
                
                this.slider.style.transform = `translate3d(${offset}%, 0, 0)`;
            }

            // Touch Handlers
            handleTouchStart(e) {
                this.startX = e.touches[0].clientX;
                this.isDragging = true;
                this.slider.style.transition = 'none';
            }

            handleTouchMove(e) {
                if (!this.isDragging) return;
                
                const x = e.touches[0].clientX;
                const diff = x - this.startX;
                const width = this.slider.clientWidth;
                
                // Prevent overscrolling at edges
                if ((this.currentIndex === 0 && diff > 0) || 
                    (this.currentIndex === this.pages.length - 1 && diff < 0)) {
                    // Resistance effect
                    const resistance = diff * 0.3;
                    const offset = -(this.currentIndex * 100) + (resistance / width * 100);
                    this.slider.style.transform = `translate3d(${offset}%, 0, 0)`;
                } else {
                    const offset = -(this.currentIndex * 100) + (diff / width * 100);
                    this.slider.style.transform = `translate3d(${offset}%, 0, 0)`;
                }
                
                // Prevent default scrolling if moving horizontally
                if (Math.abs(diff) > 5) {
                    if(e.cancelable) e.preventDefault();
                }
            }

            handleTouchEnd(e) {
                if (!this.isDragging) return;
                this.isDragging = false;
                
                const endX = e.changedTouches[0].clientX;
                const diff = endX - this.startX;
                const threshold = this.slider.clientWidth * 0.2; // 20% width threshold
                
                if (diff > threshold && this.currentIndex > 0) {
                    this.goToPage(this.currentIndex - 1);
                } else if (diff < -threshold && this.currentIndex < this.pages.length - 1) {
                    this.goToPage(this.currentIndex + 1);
                } else {
                    // Revert
                    this.updateSliderPosition(true);
                }
            }
        }

        // Initialize App - Âú® DOMContentLoaded ‰πãÂêéÂàùÂßãÂåñÔºåÁ°Æ‰øù shouldSwitchPage Â∑≤ËÆæÁΩÆ
        let app = null;
        
        window.addEventListener('DOMContentLoaded', () => {
            // Á≠âÂæÖ shouldSwitchPage ËÆæÁΩÆÂÆåÊàêÂêéÂÜçÂàùÂßãÂåñ PageSlider
            setTimeout(() => {
                app = new PageSlider();
            }, 0);
        });

        // --- Mobile Menu Logic ---
        const sidebar = document.getElementById('sidebar');
        const hamburger = document.getElementById('hamburger-btn');
        const overlay = document.getElementById('sidebar-overlay');

        function toggleMenu(force) {
            const isActive = typeof force === 'boolean' ? force : !sidebar.classList.contains('active');
            
            if (isActive) {
                sidebar.classList.add('active');
                hamburger.classList.add('active');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            } else {
                sidebar.classList.remove('active');
                hamburger.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        hamburger.addEventListener('click', () => toggleMenu());
        overlay.addEventListener('click', () => toggleMenu(false));

        // Avatar Easter Egg
        const avatar = document.getElementById('avatar');
        const floatText = document.getElementById('floating-text');
        const messages = ['Wait!', 'Hey!', 'Stop touching!', 'I am ticklish!', 'Ow!', 'Hahaha!'];
        let msgIdx = 0;
        let floatTimeout;

        avatar.addEventListener('click', (e) => {
            // Prevent default behavior to ensure fast response
            e.preventDefault();
            e.stopPropagation();

            // Clear previous timer to prevent flickering
            if(floatTimeout) clearTimeout(floatTimeout);
            
            // Randomize message slightly
            floatText.textContent = messages[msgIdx % messages.length];
            
            // Force reflow to restart animation if needed
            floatText.classList.remove('show');
            void floatText.offsetWidth; // Trigger reflow
            floatText.classList.add('show');
            
            // Add shake animation to avatar
            avatar.style.transform = `scale(1.05) rotate(${Math.random() * 10 - 5}deg)`;
            setTimeout(() => avatar.style.transform = '', 200);

            floatTimeout = setTimeout(() => {
                floatText.classList.remove('show');
            }, 1500); // Show for longer
            
            msgIdx++;
        });

        // --- Theme Switcher Logic (Light/Dark Toggle) ---
        const themeBtn = document.getElementById('theme-btn');
        const iconDark = document.getElementById('icon-dark');
        const iconLight = document.getElementById('icon-light');
        let isDarkMode = true; // Default

        // Light Theme Colors
        const lightTheme = {
            '--bg-primary': '#F1F5F9',
            '--bg-secondary': '#FFFFFF',
            '--bg-tertiary': '#E2E8F0',
            '--text-primary': '#0F172A',
            '--text-secondary': '#475569',
            '--text-muted': '#64748B',
            '--glass-bg': 'rgba(255, 255, 255, 0.7)',
            '--glass-bg-hover': 'rgba(255, 255, 255, 0.9)',
            '--glass-border': 'rgba(0, 0, 0, 0.05)',
            '--shadow-sm': '0 2px 4px rgba(0, 0, 0, 0.05)',
            '--shadow-md': '0 4px 6px rgba(0, 0, 0, 0.1)',
            '--shadow-lg': '0 10px 15px rgba(0, 0, 0, 0.1)',
            '--accent-blue': '#4F46E5', 
            '--accent-purple': '#7C3AED',
            '--hero-text-gradient': 'linear-gradient(to right, #0F172A, #475569)',
            '--stat-color': '#0F172A',
            '--nav-icon-filter': 'invert(1) grayscale(1) brightness(0.5)',
            '--nav-icon-active-filter': 'invert(1) grayscale(0) brightness(0.8) drop-shadow(0 0 2px rgba(79, 70, 229, 0.3))',
            '--skill-icon-filter': 'invert(1) brightness(0.5)',
            '--list-icon-filter': 'invert(1) brightness(0.5)',
            '--list-icon-colored-filter': 'none',
            '--tool-title-gradient': 'linear-gradient(to right, #0F172A, #475569)',
            '--input-bg': 'rgba(255, 255, 255, 0.5)'
        };

        // Dark Theme Colors (Deep Space Default)
        const darkTheme = {
            '--bg-primary': '#0B0C15',
            '--bg-secondary': '#151621',
            '--bg-tertiary': '#1E1F2E',
            '--text-primary': '#F8FAFC',
            '--text-secondary': '#94A3B8',
            '--text-muted': '#64748B',
            '--glass-bg': 'rgba(255, 255, 255, 0.03)',
            '--glass-bg-hover': 'rgba(255, 255, 255, 0.06)',
            '--glass-border': 'rgba(255, 255, 255, 0.08)',
            '--shadow-sm': '0 2px 4px rgba(0, 0, 0, 0.3)',
            '--shadow-md': '0 8px 16px rgba(0, 0, 0, 0.4)',
            '--shadow-lg': '0 16px 32px rgba(0, 0, 0, 0.5)',
            '--accent-blue': '#6366F1',
            '--accent-purple': '#8B5CF6',
            '--hero-text-gradient': 'linear-gradient(to right, #fff, #94a3b8)',
            '--stat-color': '#fff',
            '--nav-icon-filter': 'grayscale(1) brightness(0.7)',
            '--nav-icon-active-filter': 'grayscale(0) brightness(1) drop-shadow(0 0 5px var(--accent-blue))',
            '--skill-icon-filter': 'drop-shadow(0 0 10px rgba(99, 102, 241, 0.3))',
            '--list-icon-filter': 'drop-shadow(0 0 5px rgba(255,255,255,0.1))',
            '--list-icon-colored-filter': 'none',
            '--tool-title-gradient': 'linear-gradient(to right, #fff, #94a3b8)',
            '--input-bg': 'rgba(0, 0, 0, 0.2)',
            '--tool-card-icon-filter': 'drop-shadow(0 0 5px rgba(99, 102, 241, 0.5))',
            '--tool-nav-icon-filter': 'drop-shadow(0 2px 4px rgba(0,0,0,0.2))'
        };

        function applyThemeToFrame(frame, themeVars) {
            try {
                if (frame.contentDocument) {
                    const frameRoot = frame.contentDocument.documentElement;
                    for (const [key, value] of Object.entries(themeVars)) {
                        frameRoot.style.setProperty(key, value);
                    }
                }
            } catch(e) { console.error('Theme sync failed for frame', e); }
        }

        // ÂàõÂª∫ÈöêËóèËæìÂÖ•Ê°ÜÁî®‰∫é‰∏ªÈ¢òÁä∂ÊÄÅÂêåÊ≠•
        const themeStateInput = document.createElement('input');
        themeStateInput.type = 'hidden';
        themeStateInput.id = 'theme-state';
        themeStateInput.value = 'dark'; // ÈªòËÆ§ÊöóËâ≤
        document.body.appendChild(themeStateInput);

        function applyTheme(themeVars) {
            const root = document.documentElement;
            for (const [key, value] of Object.entries(themeVars)) {
                root.style.setProperty(key, value);
            }
            
            // Sync with all existing iframes
            const frames = document.querySelectorAll('iframe');
            frames.forEach(frame => applyThemeToFrame(frame, themeVars));
            
            // Êõ¥Êñ∞ÈöêËóèËæìÂÖ•Ê°ÜÁöÑÂÄºÔºåËß¶Âèë iframe ‰∏≠ÁöÑÁõëÂê¨Âô®
            const isDark = themeVars['--bg-primary'] === '#0B0C15';
            themeStateInput.value = isDark ? 'dark' : 'light';
            
            // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂ÔºåÈÄöÁü•ÊâÄÊúâ iframe ‰∏ªÈ¢òÂ∑≤ÂèòÂåñ
            window.dispatchEvent(new CustomEvent('themeChanged', { 
                detail: { theme: isDark ? 'dark' : 'light' } 
            }));
        }

        themeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            isDarkMode = !isDarkMode;
            
            const currentTheme = isDarkMode ? darkTheme : lightTheme;
            applyTheme(currentTheme);
            
            if (isDarkMode) {
                iconDark.style.display = 'block';
                iconLight.style.display = 'none';
            } else {
                iconDark.style.display = 'none';
                iconLight.style.display = 'block';
            }
        });

        // Êö¥Èú≤Áªô PageSlider ‰ΩøÁî®
        window.getCurrentTheme = () => isDarkMode ? darkTheme : lightTheme;
    </script>
</body>
</html>